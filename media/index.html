<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- CSP pour le webview -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; img-src {{cspSource}}; script-src {{cspSource}}; style-src {{cspSource}} 'unsafe-inline';">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stack Visualizer</title>

  <link rel="stylesheet" href="{{styleUri}}">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="title">Stack Visualizer</div>
      <div id="status" class="status">En attente de données...</div>
    </header>

    <!-- Step controls -->
    <section class="controls">
      <button id="btnPrev" class="btn">&larr;</button>
      <input id="stepRange" type="range" min="1" max="1" value="1" />
      <button id="btnNext" class="btn">&rarr;</button>
      <div class="step-label">
        Étape: <span id="stepLabel">1</span>
      </div>
      <div class="mode-toggle" role="group" aria-label="Mode d'affichage">
        <span class="mode-label">Mode</span>
        <button id="modeBeginner" class="btn btn-toggle">Débutant</button>
        <button id="modeExpert" class="btn btn-toggle">Expert</button>
      </div>
      <!-- Intent overlay: désactivé (commenté) -->
      <!--
      <div class="mode-toggle" role="group" aria-label="Intent overlay">
        <span class="mode-label">Intent</span>
        <button id="toggleIntent" class="btn btn-toggle" title="Afficher/masquer les annotations pédagogiques">Show intent overlay</button>
      </div>
      -->
      <div class="mode-toggle" role="group" aria-label="Reasoning panel">
        <span class="mode-label">Raisonnement</span>
        <button id="toggleReasoning" class="btn btn-toggle" title="Afficher/masquer le panneau de raisonnement">Show reasoning panel</button>
      </div>
    </section>

    <!-- Current instruction -->
    <section class="instr-box">
      Instruction actuelle : <span id="instrLabel">(aucune)</span>
    </section>

    <!-- Stack frame summary (SP/BP + heuristic explanation) -->
    <section class="frame-box">
      <div class="context-title">Stack Frame</div>
      <div id="frameContext" class="context-body">Aucune info frame.</div>
    </section>

    <!-- Visual panels: stack, registers, disassembly -->
    <section class="visuals">
      <div class="stack-container">
        <div class="panel-header">
          <h2 class="panel-title">Pile</h2>
          <div id="stackLegend" class="legend"></div>
        </div>
        <div id="stackAnnotations" class="stack-annotations"></div>
        <div id="stack" class="stack"></div>
        <div class="memory-dump">
          <div class="panel-subtitle">Dump autour de SP</div>
          <pre id="memoryDump" class="memory-pre"></pre>
        </div>
      </div>
      <div class="registers-container">
        <h2 class="panel-title">Registres</h2>
        <div id="registers" class="registers"></div>
      </div>
      <div id="reasoningPanel" class="reasoning-container">
        <div class="panel-header">
          <h2 class="panel-title">Raisonnement</h2>
        </div>
        <div id="reasoningBody" class="reasoning"></div>
      </div>
      <!-- Disassembly view (mirrors output.disasm.asm) -->
      <!-- <div class="disasm-container">
        <h2 class="panel-title">Désassemblage</h2>
        <div id="disasm" class="disasm"></div>
      </div>-->
    </section>
  </div>

  <script src="{{scriptUri}}"></script>
</body>
</html>