<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- CSP pour le webview -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; img-src {{cspSource}}; script-src {{cspSource}}; style-src {{cspSource}} 'unsafe-inline';">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stack Visualizer</title>

  <link rel="stylesheet" href="{{styleUri}}">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="title">Stack Visualizer</div>
      <div id="status" class="status">En attente de données...</div>
    </header>

    <!-- Step controls -->
    <section class="controls">
      <button id="btnPrev" class="btn">&larr;</button>
      <input id="stepRange" type="range" min="1" max="1" value="1" />
      <button id="btnNext" class="btn">&rarr;</button>
      <div class="step-label">
        Étape: <span id="stepLabel">1</span>
      </div>
    </section>

    <!-- Current instruction -->
    <section class="instr-box">
      Instruction actuelle : <span id="instrLabel">(aucune)</span>
    </section>

    <!-- Context panel (C + ASM explanation) -->
    <section class="context-box">
      <div class="context-title">Contexte</div>
      <div class="context-row">
        <span class="context-label">C</span>
        <span id="codeContext" class="context-body">Aucune info de debug.</span>
      </div>
      <div class="context-row">
        <span class="context-label">ASM</span>
        <span id="asmContext" class="context-body">Aucune instruction.</span>
      </div>
    </section>

    <!-- AST risks (Python only) -->
    <section class="risks-panel">
      <h2 class="panel-title">Zones à risque (AST)</h2>
      <div id="risks" class="risks"></div>
    </section>

    <!-- Visual panels: stack, registers, disassembly -->
    <section class="visuals">
      <div class="stack-container">
        <h2 class="panel-title">Pile</h2>
        <div id="stack" class="stack"></div>
        <div class="memory-dump">
          <div class="panel-subtitle">Dump autour de SP</div>
          <pre id="memoryDump" class="memory-pre"></pre>
        </div>
      </div>
      <div class="registers-container">
        <h2 class="panel-title">Registres</h2>
        <div id="registers" class="registers"></div>
      </div>
      <div class="disasm-container">
        <h2 class="panel-title">Désassemblage</h2>
        <div id="disasm" class="disasm"></div>
      </div>
    </section>
  </div>

  <script src="{{scriptUri}}"></script>
</body>
</html>
